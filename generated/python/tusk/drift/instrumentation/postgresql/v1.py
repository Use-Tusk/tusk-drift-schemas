# Generated by the protocol buffer compiler.  DO NOT EDIT!
# sources: postgresql/postgresql.proto
# plugin: python-betterproto
from dataclasses import dataclass
from datetime import datetime
from typing import Dict, List

import betterproto

from .google import protobuf


class TransactionState(betterproto.Enum):
    """Transaction state enumeration"""

    TRANSACTION_STATE_UNSPECIFIED = 0
    TRANSACTION_STATE_IDLE = 1
    TRANSACTION_STATE_ACTIVE = 2
    TRANSACTION_STATE_IDLE_IN_TRANSACTION = 3
    TRANSACTION_STATE_IDLE_IN_FAILED_TRANSACTION = 4


class IsolationLevel(betterproto.Enum):
    """PostgreSQL isolation levels"""

    ISOLATION_LEVEL_UNSPECIFIED = 0
    ISOLATION_LEVEL_READ_UNCOMMITTED = 1
    ISOLATION_LEVEL_READ_COMMITTED = 2
    ISOLATION_LEVEL_REPEATABLE_READ = 3
    ISOLATION_LEVEL_SERIALIZABLE = 4


@dataclass
class PostgreSQLQuery(betterproto.Message):
    """
    PostgreSQL query request - used internally by PostgreSQL instrumentation
    SDK
    """

    # Core query information
    text: str = betterproto.string_field(1)
    values: List[str] = betterproto.string_field(2)
    client_type: str = betterproto.string_field(3)
    # Connection context
    connection: "PostgreSQLConnection" = betterproto.message_field(4)
    options: "QueryOptions" = betterproto.message_field(5)
    # Query metadata
    query_id: str = betterproto.string_field(6)
    tags: Dict[str, str] = betterproto.map_field(
        7, betterproto.TYPE_STRING, betterproto.TYPE_STRING
    )


@dataclass
class PostgreSQLConnection(betterproto.Message):
    """PostgreSQL connection information"""

    database_name: str = betterproto.string_field(1)
    username: str = betterproto.string_field(2)
    host: str = betterproto.string_field(3)
    port: int = betterproto.int32_field(4)
    application_name: str = betterproto.string_field(5)
    connection_id: str = betterproto.string_field(6)
    ssl_enabled: bool = betterproto.bool_field(7)
    server_version: str = betterproto.string_field(8)


@dataclass
class QueryOptions(betterproto.Message):
    """Query execution options"""

    statement_timeout: int = betterproto.int32_field(1)
    query_timeout: int = betterproto.int32_field(2)
    binary_mode: bool = betterproto.bool_field(3)
    cursor_name: str = betterproto.string_field(4)
    fetch_size: int = betterproto.int32_field(5)
    read_only: bool = betterproto.bool_field(6)
    custom_options: Dict[str, str] = betterproto.map_field(
        7, betterproto.TYPE_STRING, betterproto.TYPE_STRING
    )


@dataclass
class PostgreSQLResult(betterproto.Message):
    """PostgreSQL query result - matches your trace data structure"""

    # Core result information (from your trace data)
    command: str = betterproto.string_field(1)
    row_count: int = betterproto.int32_field(2)
    oid: int = betterproto.int32_field(3, group="_oid")
    # Result data
    rows: List[protobuf.Struct] = betterproto.message_field(4)
    fields: List["PostgreSQLField"] = betterproto.message_field(5)
    # Query execution metadata
    execution_info: "QueryExecutionInfo" = betterproto.message_field(6)
    # Error information (if query failed)
    error: "PostgreSQLError" = betterproto.message_field(7, group="_error")


@dataclass
class PostgreSQLField(betterproto.Message):
    """PostgreSQL field definition (matches your trace data)"""

    name: str = betterproto.string_field(1)
    table_id: int = betterproto.int32_field(2)
    column_id: int = betterproto.int32_field(3)
    data_type_id: int = betterproto.int32_field(4)
    data_type_size: int = betterproto.int32_field(5)
    data_type_modifier: int = betterproto.int32_field(6)
    format: str = betterproto.string_field(7)
    # Additional field metadata
    data_type_name: str = betterproto.string_field(8)
    nullable: bool = betterproto.bool_field(9)
    primary_key: bool = betterproto.bool_field(10)


@dataclass
class QueryExecutionInfo(betterproto.Message):
    """Query execution information"""

    # Timing breakdown
    parse_time_ms: int = betterproto.int64_field(1)
    plan_time_ms: int = betterproto.int64_field(2)
    execute_time_ms: int = betterproto.int64_field(3)
    total_time_ms: int = betterproto.int64_field(4)
    # Execution statistics
    rows_examined: int = betterproto.int64_field(5)
    rows_returned: int = betterproto.int64_field(6)
    bytes_sent: int = betterproto.int64_field(7)
    bytes_received: int = betterproto.int64_field(8)
    # Query plan information (optional)
    execution_plan: str = betterproto.string_field(9)
    notices: List[str] = betterproto.string_field(10)


@dataclass
class PostgreSQLError(betterproto.Message):
    """PostgreSQL-specific error information"""

    sql_state: str = betterproto.string_field(1)
    message: str = betterproto.string_field(2)
    detail: str = betterproto.string_field(3)
    hint: str = betterproto.string_field(4)
    position: str = betterproto.string_field(5)
    where: str = betterproto.string_field(6)
    schema_name: str = betterproto.string_field(7)
    table_name: str = betterproto.string_field(8)
    column_name: str = betterproto.string_field(9)
    constraint_name: str = betterproto.string_field(10)
    data_type_name: str = betterproto.string_field(11)
    file: str = betterproto.string_field(12)
    line: str = betterproto.string_field(13)
    routine: str = betterproto.string_field(14)


@dataclass
class PostgreSQLPreparedStatement(betterproto.Message):
    """Prepared statement information"""

    statement_name: str = betterproto.string_field(1)
    query_text: str = betterproto.string_field(2)
    parameter_types: List["PostgreSQLParameterType"] = betterproto.message_field(3)
    prepared_at: datetime = betterproto.message_field(4)
    execution_count: int = betterproto.int32_field(5)


@dataclass
class PostgreSQLParameterType(betterproto.Message):
    """Parameter type information for prepared statements"""

    position: int = betterproto.int32_field(1)
    data_type_id: int = betterproto.int32_field(2)
    data_type_name: str = betterproto.string_field(3)
    nullable: bool = betterproto.bool_field(4)


@dataclass
class PostgreSQLTransaction(betterproto.Message):
    """Transaction context"""

    transaction_id: str = betterproto.string_field(1)
    state: "TransactionState" = betterproto.enum_field(2)
    isolation_level: "IsolationLevel" = betterproto.enum_field(3)
    read_only: bool = betterproto.bool_field(4)
    started_at: datetime = betterproto.message_field(5)


@dataclass
class PostgreSQLBatch(betterproto.Message):
    """Batch query support"""

    queries: List["PostgreSQLQuery"] = betterproto.message_field(1)
    stop_on_error: bool = betterproto.bool_field(2)
    return_results: bool = betterproto.bool_field(3)


@dataclass
class PostgreSQLBatchResult(betterproto.Message):
    """Batch result"""

    results: List["PostgreSQLResult"] = betterproto.message_field(1)
    successful_queries: int = betterproto.int32_field(2)
    failed_queries: int = betterproto.int32_field(3)
    first_error: "PostgreSQLError" = betterproto.message_field(4, group="_first_error")
